<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Nedu Wallet (mit GitHub-Sync)</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    input, button { width: 100%; padding: 10px; margin-top: 10px; }
    .info { margin-top: 20px; }
  </style>
</head>
<body>
<h2>Nedu Wallet (Live-Sync mit GitHub)</h2>
<input id="github_user" placeholder="GitHub Username">
<input id="github_repo" placeholder="Repo Name (z. B. nedu-chain)">
<input id="wallet_seed" placeholder="Seed Phrase (12 Wörter)">
<button onclick="loadWallet()">Wallet laden & Sync starten</button>

<div class="info">
  <p><b>Adresse:</b> <span id="addr">-</span></p>
  <p><b>Live-Balance (von GitHub):</b> <span id="bal">0</span> NEDU</p>
</div>

<script>
async function sha256(str) {
  const buf = new TextEncoder().encode(str);
  const hashBuf = await crypto.subtle.digest("SHA-256", buf);
  return Array.from(new Uint8Array(hashBuf)).map(b => b.toString(16).padStart(2, '0')).join('');
}

async function loadWallet() {
  const seed = document.getElementById("wallet_seed").value.trim();
  const user = document.getElementById("github_user").value.trim();
  const repo = document.getElementById("github_repo").value.trim();
  if (!seed || seed.split(" ").length !== 12) return alert("Seed-Phrase ungültig");
  const address = (await sha256(seed)).slice(0, 16);
  document.getElementById("addr").textContent = address;

  const url = `https://raw.githubusercontent.com/${user}/${repo}/main/blocks.json`;
  try {
    const res = await fetch(url);
    const chain = await res.json();
    let balance = 0;
    for (let b of chain) {
      if (b.miner === address) balance += b.reward || 0;
    }
    document.getElementById("bal").textContent = balance.toFixed(2);
  } catch (e) {
    alert("Fehler beim Laden von GitHub: " + e.message);
  }
}
</script>
</body>
</html>